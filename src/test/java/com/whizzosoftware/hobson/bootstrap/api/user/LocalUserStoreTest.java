package com.whizzosoftware.hobson.bootstrap.api.user;

import com.whizzosoftware.hobson.api.hub.*;
import com.whizzosoftware.hobson.api.property.PropertyContainer;
import com.whizzosoftware.hobson.api.property.PropertyContainerClass;
import com.whizzosoftware.hobson.api.property.PropertyContainerClassContext;
import com.whizzosoftware.hobson.api.data.DataStreamManager;
import com.whizzosoftware.hobson.api.user.HobsonUser;
import com.whizzosoftware.hobson.api.variable.GlobalVariable;
import com.whizzosoftware.hobson.api.variable.GlobalVariableContext;
import com.whizzosoftware.hobson.bootstrap.rest.oidc.LocalOIDCConfigProvider;
import org.junit.Test;

import java.util.Collection;
import java.util.Map;

import static org.junit.Assert.*;

public class LocalUserStoreTest {
    @Test
    public void testAuthenticate() {
        HubManager hubManager = new HubManager() {
            @Override
            public String getVersion(HubContext hubContext) {
                return null;
            }

            @Override
            public Collection<HubContext> getAllHubs() {
                return null;
            }

            @Override
            public Collection<HubContext> getHubs(String userId) {
                return null;
            }

            @Override
            public HobsonHub getHub(HubContext ctx) {
                return null;
            }

            @Override
            public String getUserIdForHubId(String hubId) {
                return null;
            }

            @Override
            public void deleteConfiguration(HubContext ctx) {
            }

            @Override
            public boolean authenticateHub(HubCredentials credentials) {
                return false;
            }

            @Override
            public PropertyContainer getConfiguration(HubContext ctx) {
                return null;
            }

            @Override
            public PropertyContainerClass getConfigurationClass(HubContext ctx) {
                return null;
            }

            @Override
            public PropertyContainerClass getContainerClass(PropertyContainerClassContext ctx) {
                return null;
            }

            @Override
            public boolean hasPropertyContainerClass(PropertyContainerClassContext ctx) {
                return false;
            }

            @Override
            public LineRange getLog(HubContext ctx, long startLine, long endLine, Appendable appendable) {
                return null;
            }

            @Override
            public LocalHubManager getLocalManager() {
                return new LocalHubManager() {
                    @Override
                    public NetworkInfo getNetworkInfo() {
                        return null;
                    }

                    @Override
                    public boolean authenticateLocal(HubContext ctx, String password) {
                        return (password.equals("local"));
                    }

                    @Override
                    public void setLocalPassword(HubContext ctx, PasswordChange change) {

                    }

                    @Override
                    public void addErrorLogAppender(Object aAppender) {

                    }

                    @Override
                    public void removeLogAppender(Object aAppender) {

                    }

                    @Override
                    public void setWebSocketUri(String uri) {

                    }

                    @Override
                    public void addDataStreamManager(DataStreamManager manager) {

                    }

                    @Override
                    public void publishWebApplication(HubWebApplication app) {

                    }

                    @Override
                    public void unpublishWebApplication(String path) {

                    }
                };
            }

            @Override
            public Collection<String> getSerialPorts(HubContext hctx) {
                return null;
            }

            @Override
            public void sendTestEmail(HubContext ctx, PropertyContainer config) {

            }

            @Override
            public void sendEmail(HubContext ctx, String recipientAddress, String subject, String body) {

            }

            @Override
            public void setConfiguration(HubContext ctx, PropertyContainer configuration) {

            }

            @Override
            public void setGlobalVariable(GlobalVariableContext gctx, Object value, long timestamp) {

            }

            @Override
            public void setGlobalVariables(Map<GlobalVariableContext, Object> values, long timestamp) {

            }

            @Override
            public GlobalVariable getGlobalVariable(GlobalVariableContext gctx) {
                return null;
            }

            @Override
            public Collection<GlobalVariable> getGlobalVariables(HubContext hctx) {
                return null;
            }
        };

        LocalUserStore mgr = new LocalUserStore();
        mgr.hubManager = hubManager;
        mgr.oidcConfigProvider = new LocalOIDCConfigProvider();
        HobsonUser user = mgr.authenticate("local", "local").getUser();
        assertNotNull(user);

        assertEquals("local", user.getId());
        assertEquals("Local", user.getGivenName());
        assertEquals("User", user.getFamilyName());
        assertNull(user.getEmail());
    }
}
